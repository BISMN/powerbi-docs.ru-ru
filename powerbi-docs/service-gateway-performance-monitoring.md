---
title: Наблюдение за шлюза (Предварительная версия)
description: В этой статье сведения о наблюдении за производительностью действий шлюз локальных данных.
author: mgblythe
ms.author: mblythe
manager: kfile
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-gateways
ms.topic: conceptual
ms.date: 05/08/2019
LocalizationGroup: Gateways
ms.openlocfilehash: 8c5f4170383f31ea465ebb7035aebfb53f551982
ms.sourcegitcommit: af2b2238fe77eaa1b2392a19a143a0250b8665cf
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/11/2019
ms.locfileid: "65535374"
---
# <a name="gateway-performance-monitoring-public-preview"></a>Наблюдение за шлюза (Предварительная версия)

Для наблюдения за производительностью, администраторов шлюза традиционно зависят от вручную мониторинга счетчики производительности с помощью системного монитора Windows. Теперь мы предлагаем ведение журнала дополнительных запросов и [файл шаблона элемента невыполненной работы производительности шлюза](http://download.microsoft.com/download/D/A/1/DA1FDDB8-6DA8-4F50-B4D0-18019591E182/GatewayPerformanceMonitoring.pbit) результатов. Эта функция предоставляет новые ценные сведения об использовании шлюза и позволяет устранить медленной производительности запросов.

> [!NOTE]
> Эта функция сейчас доступна только для локального шлюза данных в стандартном режиме, а не для персонального режима.

## <a name="enable-performance-logging"></a>Включить ведение журнала производительности

Чтобы включить эту функцию, внесите следующие изменения для *Microsoft.PowerBI.DataMovement.Pipeline.GatewayCore.dll.config* файл в «\Program Files\On-локальный шлюз данных» папка:

1. Обновление **QueryExecutionReportOn** для _True_ включить дополнительное ведение журнала для запросов, выполняемых с помощью шлюза. Включение этого параметра создается отчет о выполнении запроса и файлы запроса выполнения статистической обработки отчетов.

   ``` xml
   <setting name="QueryExecutionReportOn" serializeAs="String">
     <value>True</value>
   </setting>
   ```

1. Обновление **SystemCounterReportOn** для _True_ включить дополнительное ведение журнала для памяти и счетчиков ЦП системы. Включение этого параметра создает файл отчета статистической обработки счетчика системы.

   ```xml
   <setting name="SystemCounterReportOn" serializeAs="String">
     <value>True</value>
   </setting>
   ```

1. Существуют другие значения в файле конфигурации, который может обновить при необходимости.

    - **ReportFilePath**: Определяет путь, где хранятся три файла журнала. По умолчанию этот путь — «gateway\Report \Users\PBIEgwService\AppData\Local\Microsoft\On-premises данных» или «Windows\ServiceProfiles\PBIEgwService\AppData\Local\Microsoft\On локальных данных gateway\Report», в зависимости от версии операционной системы. Если вы используете учетную запись службы шлюза отличный _PBIEgwService_, замените этот фрагмент пути имя учетной записи службы.
    - **ReportFileCount**: Определяет количество файлов журнала каждого типа хранения. Значение по умолчанию — 10.
    - **ReportFileSizeInBytes**: Определяет размер файла для сохранения. Значение по умолчанию — 104857600.
    - **QuerExecutionAggregationTimeInMinutes**: Определяет число минут, для которых собираются сведения о выполнении запроса. Значение по умолчанию — 5.
    - **SystemCounterAggregationTimeInMinutes**: Определяет число минут, для которых вычисляется системных счетчиков. Значение по умолчанию — 5.

1. После внесения изменений в файл конфигурации, перезапустите шлюз для этих значений конфигурации вступили в силу. Вы начнете видеть файлы отчетов, создаваемых в расположение, указанное для **ReportFilePath**.

    > [!NOTE]
    > Может занять до 10 минут, а также задать количество времени для **QuerExecutionAggregationTimeInMinutes** в файле конфигурации, пока не начнется, отображаются в папке.

## <a name="understand-performance-logs"></a>Понять, журналов производительности

При включении этой функции, мы создадим три новых файла журнала:

- Отчет о выполнении запроса
- В отчете о запросах выполнения статистической обработки
- Отчет системы статистической обработки счетчика

Отчет о выполнении запроса содержит сведения о выполнении запроса. Сохраним следующие атрибуты:

|Атрибут |Описание |
| ---- | ---- |
|**GatewayObjectId** |Уникальный идентификатор для шлюза. |
|**ИД запроса** |Уникальный идентификатор для запроса шлюза. Это может быть то же самое для нескольких запросов. |
|**Источник данных** |Содержит тип источника данных и источника данных. |
|**QueryTrackingId** |Уникальный идентификатор для запроса. |  
|**QueryExecutionEndTimeUTC** |Время завершения выполнения запроса. |
|**QueryExecutionDuration**(мс) |Длительность выполнения запроса. |
|**QueryType** |Тип запроса — например, запрос, переданный может быть обновления Power BI и DirectQuery или запросов из PowerApps и Microsoft Flow. |
|**DataProcessingEndTimeUTC** |Время, когда действиями по обработке данных, такие как постановки в очередь, получение данных, сжатие, обработки данных и т. д. завершено. |
|**DataProcessingDuration**(мс) |Длительность обработки данных действий, таких как очереди, получение данных, сжатие, обработки данных и т. д. |
|**Успех** |Указывает, если запрос успешно или неудачно. |
|**Сообщение об ошибке** |Если не удалось выполнить запрос, указывает сообщение об ошибке. |
| | |

В отчете о запросах выполнения статистической обработки содержит сведения о запросе, объединяются в интервал времени, **GatewayObjectId**, **DataSource**, **успех**и **QueryType**. Значение по умолчанию — 5 минут, но его можно настроить, как описано ниже. Сохраним следующие атрибуты:

|Атрибут |Описание |
| ---- | ---- |
|**GatewayObjectId** |Уникальный идентификатор для шлюза. |
|**AggregationStartTimeUTC** |Начало окна времени, для которого были объединены запросить атрибуты. |
|**AggregationEndTimeUTC** |Конец периода, для какой запрос агрегированных атрибуты. |
|**Источник данных** |Содержит тип источника данных и источника данных. |
|**Успех** |Указывает, если запрос успешно или неудачно. |
|**AverageQueryExecutionDuration**(мс) |Среднее время выполнения запроса для периода времени статистической обработки. |
|**MaxQueryExecutionDuration**(мс) |Время выполнения запроса для периода времени статистической обработки. |
|**MinQueryExecutionDuration**(мс) |Время выполнения минимальное запроса для периода времени статистической обработки. |
|**QueryType** |Тип запроса — например, запрос, переданный может быть обновления Power BI и DirectQuery или запросов из PowerApps и Microsoft Flow. |
|**AverageDataProcessingDuration**(мс) |Среднее время обработки данных действий, таких как очереди, получение данных, сжатие, обработки данных, и так далее для периода времени статистической обработки. |
|**MaxDataProcessingDuration**(мс) |Максимальное время периода статистической обработки время для обработки данных действий, таких как очереди, получение данных, сжатие, обработки данных и т. д. |
|**MinDataProcessingDuration**(мс) |Минимальное время для обработки данных действий, таких как очереди, получение данных, сжатие, обработки данных и т. д. для периода времени статистической обработки. |
|**Число** |Число запросов. |
| | |

В отчете статистической обработки счетчика системы содержит системные значения счетчика, группируются по промежутку времени. Значение по умолчанию — 5 минут, но его можно настроить, как описано ниже. Сохраним следующие атрибуты:

|Атрибут |Описание |
| ---- | ---- |
|**GatewayObjectId** |Уникальный идентификатор для шлюза. |
|**AggregationStartTimeUTC** |Начало периода, для которой используются системные счетчики. |
|**AggregationEndTimeUTC** |Конец окна времени, для какой системы используются счетчики. |
|**CounterName** |Системные счетчики, включая использование памяти и ЦП шлюза, гибридных веб-приложений и в целом на компьютере размещения шлюза. |
|**Max** |Максимальное значение для счетчика системы для периода времени статистической обработки. |
|**Мин.** |Минимальное значение для счетчика системы для периода времени статистической обработки. |
|**Среднее значение** |Среднее значение счетчика системы для периода времени статистической обработки. |
| | |

## <a name="visualize-gateway-performance"></a>Визуализируйте производительность шлюза

Теперь вы можете визуализировать данные в файлах журнала.

1. Скачайте [шаблона элемента невыполненной работы шлюза производительности](http://download.microsoft.com/download/D/A/1/DA1FDDB8-6DA8-4F50-B4D0-18019591E182/GatewayPerformanceMonitoring.pbit) и откройте его с помощью Power BI desktop.

1. В открывшемся диалоговом проверьте, что путь к папке совпадает со значением в **ReportFilePath**.

    ![Всплывающее окно для пути к папке](media/service-gateway-performance-monitoring/gateway-folder-path-pop-up.png)

1. Выберите **нагрузки**, и файл шаблона начинает загрузку данных из файлов журнала. Все визуальные элементы должен затем заполняться с помощью данных в отчетах.

1. При необходимости сохранить этот файл как pbix-ФАЙЛ и опубликовать его в службе для автоматических обновлений.

Кроме того можно настроить этот файл шаблона в соответствии с потребностями. Дополнительные сведения о шаблонах Power BI, см. в этом [Microsoft Power BI в блоге](https://powerbi.microsoft.com/en-us/blog/deep-dive-into-query-parameters-and-power-bi-templates/).