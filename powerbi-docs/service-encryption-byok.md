---
title: Использование собственных ключей шифрования для Power BI (предварительная версия)
description: Сведения об использовании собственных ключей шифрования в Power BI Premium.
author: mgblythe
ms.author: mblythe
manager: kfile
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-admin
ms.topic: conceptual
ms.date: 06/10/2019
LocalizationGroup: Premium
ms.openlocfilehash: 7adcfeec771796aa9fe322512f8ca8584559cea0
ms.sourcegitcommit: c122c1a8c9f502a78ccecd32d2708ab2342409f0
ms.translationtype: HT
ms.contentlocale: ru-RU
ms.lasthandoff: 06/11/2019
ms.locfileid: "66829395"
---
# <a name="bring-your-own-encryption-keys-for-power-bi-preview"></a>Использование собственных ключей шифрования для Power BI (предварительная версия)

Power BI шифрует _неактивные_ и _внутрипроцессные_ данные. По умолчанию Power BI использует для шифрования ваших данных ключи, управляемые Майкрософт. В Power BI Premium можно также использовать собственные ключи для неактивных данных, которые импортируются в набор данных (дополнительные сведения см. в разделе [Рекомендации по источнику и хранилищу данных](#data-source-and-storage-considerations)). Этот подход часто называют _использованием собственного ключа_ (BYOK).

## <a name="why-use-byok"></a>Зачем использовать BYOK?

BYOK облегчает соблюдение нормативных требований, описывающие ключевые отношения с поставщиком облачных служб (в этом случае Майкрософт). С помощью BYOK вы предоставляете ключи шифрования для неактивных данных Power BI на уровне приложения и управляете ими. В результате вы можете осуществлять контроль и отменить ключи вашей организации, если вы решите прекратить использование службы. Если отменить ключи, данные становятся нечитаемыми для службы.

## <a name="data-source-and-storage-considerations"></a>Рекомендации по источнику и хранилищу данных

Чтобы использовать BYOK, нужно отправить данные в службу Power BI из файла Power BI Desktop (PBIX). При подключении к источникам данных в Power BI Desktop нужно указать режим хранения "Импорт". BYOK запрещено использовать в следующих сценариях:

- DirectQuery
- Активное подключение к службам Analysis Services
- Книги Excel (если только данные не были сначала импортированы в Power BI Desktop)
- наборы данных рush-уведомлений;

В следующем разделе вы узнаете, как настроить Azure Key Vault, где хранятся ключи шифрования для BYOK.

## <a name="configure-azure-key-vault"></a>Настройка Azure Key Vault

Azure Key Vault — это средство для безопасного хранения секретов, таких как ключи шифрования, и доступа к ним. Можно использовать существующее хранилище ключей для хранения ключей шифрования или создать новое хранилище специально для использования с Power BI.

В инструкциях в этом разделе предполагается общее знакомство с Azure Key Vault. Дополнительные сведения см. в разделе [Что такое Azure Key Vault?](/azure/key-vault/key-vault-whatis). Настройте хранилище ключей следующим образом:

1. Добавьте службу Power BI в качестве субъекта-службы для хранилища ключей с разрешениями на упаковку и распаковку.

1. Создайте ключ RSA длиной 4096 бит (или используйте существующий ключ этого типа) с разрешениями на упаковку и распаковку.

1. Рекомендуемые требования Убедитесь, что для хранилища ключей включен параметр _обратимого удаления_.

### <a name="add-the-service-principal"></a>Добавление субъекта-службы

1. На портале Azure в хранилище ключей в разделе **Политики доступа** выберите **Добавить новый**.

1. В разделе **Выбор субъекта** найдите и выберите Microsoft.Azure.AnalysisServices.

1. В разделе **Разрешения ключей** выберите **Распаковка ключа** и **Упаковка ключа**.

    ![Компоненты файла PBIX](media/service-encryption-byok/service-principal.png)

1. Нажмите кнопку **ОК** и затем **Сохранить**.

### <a name="create-an-rsa-key"></a>Создание ключа RSA

1. В хранилище ключей в разделе **Ключи** выберите **Создать/импортировать**.

1. Выберите **Тип ключа** RSA и **Размер ключа RSA** 4096.

    ![Компоненты файла PBIX](media/service-encryption-byok/create-rsa-key.png)

1. Выберите **Создать**.

1. В разделе **Ключи** выберите созданный ключ.

1. Выберите GUID для **текущей версии** ключа.

1. Убедитесь, что выбраны значения **Распаковка ключа** и **Упаковка ключа**. Скопируйте **Идентификатор ключа** для использования при включении BYOK в Power BI.

    ![Компоненты файла PBIX](media/service-encryption-byok/key-properties.png)

### <a name="soft-delete-option"></a>Параметр обратимого удаления

Мы рекомендуем включить [обратимое удаление](/azure/key-vault/key-vault-ovw-soft-delete) в хранилище ключей для защиты от потери данных при случайном удалении ключа или хранилища ключей. Вам нужно использовать [PowerShell для включения свойства "soft-delete"](/azure/key-vault/key-vault-soft-delete-powershell) в хранилище ключей, так как этот параметр пока недоступен на портале Azure.

Настроив свойство Azure Key Vault, вы можете включать BYOK в своем клиенте.

## <a name="enable-byok-on-your-tenant"></a>Включение BYOK в клиенте

Включите BYOK на уровне клиента с помощью PowerShell, сначала представив своему клиенту Power BI ключи шифрования, созданные и сохраненные в Azure Key Vault. Назначьте эти ключи шифрования емкости Premium для шифрования содержимого в ней.

### <a name="important-considerations"></a>Важные замечания

Перед включением BYOK учитывайте следующие факторы:

- Сейчас невозможно отключить BYOK после включения. В зависимости от того, как вы включили параметры для `Add-PowerBIEncryptionKey`, можно управлять использованием BYOK для одной или нескольких ваших емкостей. Однако вы не можете отменить представление ключей вашему клиенту. Дополнительные сведения см. в разделе [Включение BYOK](#enable-byok).

- Вы не можете _напрямую_ переместить рабочую область, использующую BYOK из выделенной емкости в Power BI Premium в общую емкость. Сначала следует переместить рабочую область в выделенную емкость, где не включена функция BYOK.

### <a name="enable-byok"></a>Включение BYOK

Чтобы включить BYOK, нужно быть администратором клиента в службе Power BI и войти в систему с помощью командлета `Connect-PowerBIServiceAccount`. Затем с помощью `Add-PowerBIEncryptionKey` включите BYOK, как показано в следующем примере:

```powershell
Add-PowerBIEncryptionKey -Name'Contoso Sales' -KeyVaultKeyUri'https://contoso-vault2.vault.azure.net/keys/ContosoKeyVault/b2ab4ba1c7b341eea5ecaaa2wb54c4d2'
```

Командлет принимает три параметра, влияющих на шифрование для текущих и будущих емкостей. По умолчанию ни один из параметров не задан:

- `-Activate` — указывает, что этот ключ будет использоваться для всех существующих емкостей в клиенте.

- `-Default` — указывает, что этот ключ используется по умолчанию для всего клиента. При создании новой емкости она наследует этот ключ.

- `-DefaultAndActivate` — указывает, что этот ключ будет использоваться для всех существующих и создаваемых емкостей.

Если указать `-Default` или `-DefaultAndActivate`, все емкости, созданные в этом клиенте, с этого момента будут шифроваться с использованием указанного вами ключа (или обновленного ключа по умолчанию). Операцию по умолчанию невозможно отменить, вы потеряете возможность создавать емкость Premium, которая не использует BYOK в клиенте.

Вы можете контролировать использование BYOK в клиенте. Например, чтобы зашифровать отдельную емкость, вызовите `Add-PowerBIEncryptionKey` без `-Activate`, `-Default` или `-DefaultAndActivate`. Затем вызовите `Set-PowerBICapacityEncryptionKey` для той емкости, где вы хотите включить BYOK.

## <a name="manage-byok"></a>Управление BYOK

Power BI предоставляет дополнительные командлеты для управления BYOK в клиенте:

- Используйте `Get-PowerBIEncryptionKey`, чтобы получить ключ, который сейчас использует ваш клиент:

    ```powershell
    Get-PowerBIEncryptionKey
    ```

- Используйте `Get-PowerBIWorkspaceEncryptionStatus`, чтобы узнать, шифруются ли наборы данных в рабочей области и синхронизировано ли их состояние шифрования с рабочей областью:

    ```powershell
    Get-PowerBIWorkspaceEncryptionStatus -Name'Contoso Sales'
    ```

    Обратите внимание на то, что шифрование включено на уровне емкости, но вы получаете состояние шифрования на уровне набора данных для указанной рабочей области.

- Используйте `Set-PowerBICapacityEncryptionKey`, чтобы обновить ключ шифрования для емкости Power BI:

    ```powershell
    Set-PowerBICapacityEncryptionKey-CapacityId 08d57fce-9e79-49ac-afac-d61765f97f6f -KeyName 'Contoso Sales'
    ```

- `Use Switch-PowerBIEncryptionKey` для переключения (или _смены_) ключа, используемого для шифрования. Командлет просто обновляет `-KeyVaultKeyUri` для ключа `-Name`:

    ```powershell
    Switch-PowerBIEncryptionKey -Name'Contoso Sales' -KeyVaultKeyUri'https://contoso-vault2.vault.azure.net/keys/ContosoKeyVault/b2ab4ba1c7b341eea5ecaaa2wb54c4d2'
    ```