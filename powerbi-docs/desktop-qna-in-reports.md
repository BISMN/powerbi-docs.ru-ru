---
title: Использование обработчика "Вопросы и ответы" в Power BI Desktop
description: Теперь с помощью обработчика "Вопросы и ответы" в Power BI Desktop можно использовать запросы на естественном языке.
author: maggiesMSFT
manager: kfile
ms.reviewer: ''
ms.service: powerbi
ms.subservice: powerbi-desktop
ms.topic: conceptual
ms.date: 12/05/2018
ms.author: maggies
LocalizationGroup: Create reports
ms.openlocfilehash: a34de25af7febf63b34d7608ff7ef40e8b653fc4
ms.sourcegitcommit: 60dad5aa0d85db790553e537bf8ac34ee3289ba3
ms.translationtype: MT
ms.contentlocale: ru-RU
ms.lasthandoff: 05/29/2019
ms.locfileid: "61285044"
---
# <a name="use-qa-in-power-bi-desktop-for-natural-language-queries"></a>Использование обработчика "Вопросы и ответы" в Power BI Desktop для запросов на естественном языке
Эффективный обработчик позволяет задавать вопросы о данных с помощью обычных фраз и естественного языка. Еще больше впечатляет, когда от данных поступает ответ. Именно эту возможность предоставляет обработчик "Вопросы и ответы" в **Power BI Desktop**.

Чтобы обработчик успешно интерпретировал большое количество вопросов, на которые он способен отвечать, он должен строить допущения относительно модели. Если структура модели не соответствует одному или нескольким допущениям, необходимо настроить модель. В настройках для обработчика "Вопросы и ответы" следует применять те же методы оптимизации, которые используются для любой другой модели в Power BI, независимо от того, используете ли вы обработчик "Вопросы и ответы". 

> [!NOTE]
> Q & A доступна только при работе с моделью, которая содержит **импорта** данных или для активных подключений к SSAS. Модели DirectQuery не поддерживаются.
>
> Функция вопросов и ответов требует указанное ниже обновление среды выполнения C, если вы используете версию Windows младше Windows 10. Можно попытаться установить важные обновления из Центра обновления Windows или вручную установить необходимый компонент от корпорации Майкрософт (KB2999226). [https://support.microsoft.com/en-us/help/2999226/update-for-universal-c-runtime-in-windows](https://support.microsoft.com/help/2999226/update-for-universal-c-runtime-in-windows)
>
>

В следующих разделах объясняется, как настроить модель, чтобы она правильно работала с обработчиком "Вопросы и ответы".

## <a name="add-missing-relationships"></a>Добавление отсутствующих связей

Если в модели нет связей между таблицами, их невозможно будет соединить ни с помощью отчетов Power BI, ни с помощью компонента "Вопросы и ответы", если вы задаете вопрос об этих таблицах. Связи являются основой хорошей модели. Например, нельзя использовать запрос "общий объем продаж клиентам в Сиэтле", если между таблицами *заказов* и *клиентов* отсутствует связь. На следующих изображениях представлены примеры модели, которую нужно настроить, и модели, которая готова для работы с обработчиком "Вопросы и ответы".

**Нужно настроить**

![Связи, которые нужно настроить для работы с обработчиком "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_01.png)

**Готова для работы с обработчиком "Вопросы и ответы"**

![Связи правильно настроены для работы с обработчиком "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_02.png)


## <a name="rename-tables-and-columns"></a>Переименование таблиц и столбцов

Выбор таблиц и столбцов имеет большое значение для обработчика "Вопросы и ответы". Например, предположим, у вас есть таблица с именем *Сводка клиентов*, содержащая список клиентов. Необходимо использовать запросы вроде "Отобразить сводку клиентов в Чикаго" вместо "Отобразить клиентов в Чикаго". 

Хотя обработчик "Вопросы и ответы" может разбивать запрос на слова и обнаруживать множественное число, он предполагает, что имена таблиц и столбцов точно отражают их содержимое.

Рассмотрим другой пример. Представьте, что у вас есть таблица с именем *Учет сотрудников*, содержащая имена, фамилии и количество сотрудников. У вас есть другая таблица с именем *Сотрудники*, содержащая количество сотрудников, должностей и даты поступления на работу. Люди, знакомые с моделью, могут понять такую структуру. Другой пользователь, который отправит запрос "Пересчитать сотрудников" получит количество строк из таблицы "Сотрудники". Такой результат, скорее всего, представляет не то, что пользователь имел в виду, так как он отражает количество должностей,которые каждый сотрудник занимал в течение своего трудового стажа. Лучше переименовать эти таблицы, чтобы имена отражали их содержимое.

**Нужно настроить**

![Имена таблиц, которые нужно изменить для работы с обработчиком "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_03.png)

**Готова для работы с обработчиком "Вопросы и ответы"**

![Имена таблиц правильно настроены для работы с обработчиком "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_04.png)

## <a name="fix-incorrect-data-types"></a>Исправление неправильных типов данных

Импортированные данные могут содержать неправильные типы данных. Например, столбцы *даты* и *количества*, которые импортируются как *строки*, обработчик "Вопросы и ответы" не интерпретирует как значения даты и количества. Необходимо выбрать правильный тип данных в модели Power BI.

![Выбор правильного типа данных, который будет доступен для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_05.png)

## <a name="mark-year-and-identifier-columns-as-dont-summarize"></a>Значение "Не суммировать" для столбцов года и идентификатора

По умолчанию Power BI агрессивно вычисляет числовые столбцы, поэтому, например, на запрос "общий объем продаж за год" может поступить ответ в виде огромного количества продаж за большое количество лет. Если некоторые столбцы не нужно так вычислять, установите для свойства **Суммировать по** значение **Don’t Summarize** (Не суммировать). Обратите внимание, что со столбцами **год**, **месяц**, **день** и **идентификатор** проблемы возникают чаще всего. Другие столбцы, значения которых не нужно суммировать, например *возраст*, также могут выиграть, если для свойства **Суммировать по** указать значение **Don’t Summarize** (Не суммировать) или **Average** (Среднее). Этот параметр находится на вкладке **Моделирование**.

![Не суммируйте такие столбцы, как "год", "месяц" и "дата", для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_06.png)

## <a name="choose-a-data-category-for-each-date-and-geography-column"></a>Выбор категории данных для каждого столбца "дата" и "географический регион"

Параметр **Категория данных** предоставляет дополнительные сведения о семантике содержимого за пределами своего типа данных. Например, столбец с целым числом может быть помечен как "почтовый индекс", столбец со строкой может быть помечен как "город", "страна", "регион" и т. д. Обработчик "Вопросы и ответы" использует эту информацию для двух важных задач: выбора визуализации и смещения языка.

Во-первых, обработчик "Вопросы и ответы" использует сведения **категории данных**, чтобы выбрать вариант визуального представления. Например, он определяет, что столбцы с **категорией данных** "дата" или "время" обычно лучше отображать на горизонтальной оси графика или на оси воспроизведения в пузырьковой диаграмме. Он также предполагает, что результаты, содержащие столбцы с географическими **категориями данных**, целесообразно показать на карте.

Кроме того, обработчик "Вопросы и ответы" делает обоснованные предположения о том, как пользователи могут называть столбцы "дата" и "географический регион", что помогает ему интерпретировать определенные типы вопросов. Например, слово "когда" в запросе "Когда Ивана Кузнецова приняли на работу?" почти наверняка касается столбца даты, а в запросе "Количество клиентов в Иванове", скорее всего, подразумевается город Иваново, а не фамилия Иванов.


![Выбор правильной категории данных для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_07.png)

## <a name="choose-a-sort-by-column-for-relevant-columns"></a>Выбор свойства "Сортировать по столбцу" для соответствующих столбцов

Свойство **Сортировать по столбцу** позволяет при сортировке по одному столбцу выполнять автоматическую сортировку по другому столбцу. Например, при запросе "Сортировать клиентов по размеру рубашки" может понадобиться сортировать столбец "Размер рубашки" по возрастанию (XS, S, M, L, XL), а не в алфавитном порядке (L, M, S, XL, XS).

![Выбор правильного свойства "Сортировать по столбцу" для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_08.png)

## <a name="normalize-your-model"></a>Нормализация модели

Не беспокойтесь, мы не предлагаем вам полностью переделывать модель. Однако некоторые структуры являются настолько сложными, что обработчик "Вопросы и ответы" не может обработать их правильно. Если выполнить основную нормализацию структуры модели, использовать отчеты Power BI станет значительно удобнее. Кроме того, обработчик "Вопросы и ответы" будет давать более точные ответы.

Следуйте этому общему правилу: Каждая уникальная "вещь", о которой говорит пользователь, должна быть представлена только одним объектом в модели (таблицей или столбцом). Поэтому, если пользователь говорит о клиентах, должен быть один объект *клиент*. Если пользователь говорит о продажах, должен быть один объект *продажи*. Все просто, правда? Возможно, но это зависит от формы данных, с которой вы начинаете работать. В **редакторе запросов** доступны возможности изменения формы, если они вам нужны. Но многие более простые преобразования можно выполнять с помощью вычислений в модели Power BI.

В следующих разделах содержатся некоторые распространенные преобразования, которые могут вам понадобиться.

### <a name="create-new-tables-for-multi-column-entities"></a>Создание новых таблиц для сущностей с несколькими столбцами

Если несколько столбцов функционируют как единый отдельный блок в большой таблице, эти столбцы следует разделить на подтаблицы. Например, предположим, у вас есть столбец "Имя контакта", "Должность контакта" и "Телефон контакта" в таблице *Компании*. Лучше создать отдельную таблицу *Контакты*, которая будет содержать имя, должность и телефон, а также ссылку на таблицу *Компании* Этот подход упрощает отправку вопросов о контактах независимо от вопросов о компании, контактами которой они являются, а также позволяет более гибко отображать результаты.

**Нужно настроить**

![Используйте несколько таблиц для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_09.png)

**Готова для работы с обработчиком "Вопросы и ответы"**

![Используйте несколько таблиц для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_10.png)

### <a name="pivot-to-eliminate-property-bags"></a>Сведение для исключения контейнеров свойств

Если в модели есть контейнеры свойств, их нужно реструктуризировать, чтобы для одного свойства существовал один столбец. Контейнеры свойств удобны для управления большим количеством свойств, но для них характерны некоторые естественные ограничения, которые ни отчеты Power BI, ни обработчик "Вопросы и ответы" не могут обойти.

Например, рассмотрим таблицу *Демографические данные клиентов* со столбцами "Идентификатор клиента", "Свойство" и "Значение", где каждая строка представляет отдельное свойство клиента (например, возраст, семейное положение, город и т. д). Если перегрузить значение столбца "Значение" на основе столбца "Свойство", обработчик "Вопросы и ответы" не сможет интерпретировать большинство запросов, которые ссылаются на него. Простой запрос, например "показать возраст каждого клиента" может сработать, так как он может быть интерпретирован как "показать клиентов и демографические данные клиентов со свойством «возраст»". Но структура модели просто не поддерживает более сложные запросы, например "средний возраст клиентов в Чикаго". Пользователи, которые непосредственно создают отчеты Power BI, иногда изобретают способы получения нужных данных. Но компонент "Вопросы и ответы" работает, только когда каждый столбец имеет только одно значение.

**Нужно настроить**

![Не используйте контейнеры свойств в моделях для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_11.png)

**Готова для работы с обработчиком "Вопросы и ответы"**

![Используйте несколько таблиц для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_12.png)

### <a name="union-to-eliminate-partitioning"></a>Объединение в избежание секционирования

Если вы разделили данные на несколько таблиц или свели значения нескольких столбцов, вашим пользователям будет трудно выполнить многие стандартные операции, или они вообще не смогут их выполнить. Сначала рассмотрим типичный пример секционирования таблиц: таблица *Продажи 2000–2010* и таблица *Продажи 2011–2020*. Если все важные отчеты доступны только для определенного десятилетия, это можно так и оставить для отчетов Power BI. Но благодаря гибкости обработчика "Вопросы и ответы" пользователи могут ожидать ответа на такой запрос, как, например, "общие продажи по годам". Чтобы этот запрос сработал, необходимо объединить данные в одну таблицу модели Power BI.

Также рассмотрим типичный столбец со сведенными значениями: таблица *Заказы экскурсий* содержит столбцы "Автор", "Заказ", "Город1", Город2" и "Город3". Такая структура не позволяет правильно обрабатывать даже такие простые запросы, как "количество заказов по городам". Чтобы запрос сработал, создайте отдельную таблицу *Города заказов экскурсий*, которая объединяет значения городов в один столбец.

**Нужно настроить**

![Не используйте контейнеры свойств в моделях для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_13.png)

**Готова для работы с обработчиком "Вопросы и ответы"**

![Используйте несколько таблиц для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_14.png)

### <a name="split-formatted-columns"></a>Разделение форматированных столбцов

Если источник, из которого импортируются данные, содержит форматированные столбцы, отчеты Power BI и обработчик "Вопросы и ответы" не смогут получить доступ к столбцу, чтобы проанализировать его содержимое. Поэтому, если у вас есть, например, столбец **Полный адрес**, в котором указаны адрес, город и страна, следует разбить его на столбцы "Адрес", "Город" и "Страна", чтобы пользователи выполняли запросы к этим столбцам по отдельности.

**Нужно настроить**

![Не используйте отдельные столбцы для нескольких элементов данных для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_15.png)

**Готова для работы с обработчиком "Вопросы и ответы"**

![Используйте несколько таблиц для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_16.png)

Точно так же, если есть столбец "ФИО" для пользователя, может потребоваться добавить столбцы **Имя** и **Фамилия** на случай, если кто-то захочет отправить запрос с использованием имени или фамилии. 


### <a name="create-new-tables-for-multi-value-columns"></a>Создание новых таблиц для столбцов с несколькими значениями

Похожая ситуация: если источник, из которого импортируются данные, содержит столбцы с несколькими значениями, отчеты Power BI и обработчик "Вопросы и ответы" не смогут получить доступ к столбцу, чтобы проанализировать его содержимое. Поэтому, если столбец "Композитор" содержит несколько имен авторов песни, его следует разбить на несколько строк в отдельной таблице *Композиторы*.

**Нужно настроить**

![Не используйте столбцы с несколькими значениями для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_17.png)

**Готова для работы с обработчиком "Вопросы и ответы"**

![Используйте несколько таблиц для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_18.png)

### <a name="denormalize-to-eliminate-inactive-relationships"></a>Денормализация во избежание неактивных связей

Единственное исключение из правила "нормализация лучше" возникает при наличии нескольких путей из одной таблицы в другую. Например, предположим, есть таблица *Рейсы* со столбцами "Идентификатор города вылета" и "Идентификатор города назначения", каждый из которых связан с таблицей *Города*. Одну из этих связей придется пометить как неактивную. Так как обработчик "Вопросы и ответы" может использовать только активные связи, вы не можете отправлять запросы о городе вылета или городе назначения в зависимости от того, что вы выбрали. Если вместо этого выполнить денормализацию столбцов с названиями городов в таблицу *Рейсы*, вы можете отправлять такие запросы: "Отобразить рейсы на завтра из Сиэтла в Сан-Франциско".

**Нужно настроить**

![Только один путь для каждой таблицы для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_19.png)

**Готова для работы с обработчиком "Вопросы и ответы"**

![Используйте несколько таблиц для обработчика "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_20.png)

### <a name="add-synonyms-to-tables-and-columns"></a>Добавление синонимов в таблицы и столбцы

Этот шаг применяется только для обработчика "Вопросы и ответы", а не для отчетов Power BI в целом. Пользователи часто используют разные термины для названия одного того же понятия, например: общий объем продаж, чистая выручка от продаж, общая чистая выручка от продаж. Модель Power BI позволяет добавить эти синонимы в таблицы и столбцы модели. 

Этот шаг может быть важен. Даже при наличии простых имен таблиц и столбцов пользователи обработчика "Вопросы и ответы" задают вопросы, используя свой привычный лексикон, а не выбирают слова из списка предопределенных столбцов. Чем больше правильно подобранных синонимов вы сможете добавить, тем удобнее будет пользователям работать с вашим отчетом. Чтобы добавить синонимы, в представлении **Связи** выберите на ленте кнопку "Синонимы", как показано на приведенном ниже рисунке.

![Добавление синонимов в обработчик "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_21.png)

Поле **Синонимы** отображается справа от **Power BI Desktop**. В это поле можно добавлять синонимы, как показано на приведенном ниже рисунке.

![Добавление синонимов в обработчик "Вопросы и ответы"](media/desktop-qna-in-reports/desktop-qna_22.png)

 Будьте внимательны при добавлении синонимов: если добавить один и тот же синоним в несколько столбцов или таблиц, появится неоднозначность. Обработчик "Вопросы и ответы" использует контекст там, где можно выбирать между неоднозначными синонимами. Но не все запросы содержат достаточно контекста. Например, пользователь просит "посчитать клиентов". Если в вашей модели три понятия называются словом "клиент", пользователь может не получить ответ на свой запрос. В таких случаях основной синоним должен быть уникальным, так как в формулировке используется именно он. Обработчик может сообщить пользователю о неоднозначности. Например, в ответе на запрос "показать количество архивных записей клиентов" он может попросить сформулировать запрос иначе.


## <a name="next-steps"></a>Дальнейшие действия
Дополнительные сведения о функциях Power BI Desktop см. в следующих статьях:

* [Использование детализации в Power BI Desktop](desktop-drillthrough.md)
* [Отображение плитки панели мониторинга или визуального элемента отчета в режиме фокусировки](consumer/end-user-focus.md)

